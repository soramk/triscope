<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>紫微斗数：天命を解き明かす皇帝の星学</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- 共通CSS -->
    <link rel="stylesheet" href="../../assets/common.css">
    <style>
        body {
            background-color: #FDFBF7;
            color: #1F2937;
            font-family: 'Noto Sans JP', sans-serif;
            line-height: 1.8;
        }

        .serif {
            font-family: 'Noto Serif JP', serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
        }

        .active-tab {
            border-bottom: 2px solid #5B21B6;
            color: #5B21B6;
            font-weight: 600;
        }

        .inactive-tab {
            border-bottom: 2px solid transparent;
            color: #6B7280;
        }

        .palace-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #E5E7EB;
        }

        .palace-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: #5B21B6;
        }

        .palace-card.active {
            background-color: #F5F3FF;
            border-color: #5B21B6;
            box-shadow: inset 0 0 0 1px #5B21B6;
        }

        .star-link {
            transition: all 0.2s ease;
            color: #6B7280;
        }

        .star-link:hover {
            color: #5B21B6;
            padding-left: 0.5rem;
        }

        .star-link.active {
            color: #5B21B6;
            font-weight: bold;
            border-left: 3px solid #5B21B6;
            padding-left: 0.75rem;
        }

        .reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease-out;
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Result Animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="selection:bg-indigo-100">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-indigo-900 serif tracking-wide">紫微斗数</span>
                    <span class="ml-2 text-xs text-indigo-500 uppercase tracking-widest hidden sm:block">Zi Wei Dou
                        Shu</span>
                </div>
                <div class="flex items-center space-x-6 text-sm font-medium">
                    <a href="#calculator" class="text-gray-600 hover:text-indigo-700">簡易診断</a>
                    <a href="#overview" class="text-gray-600 hover:text-indigo-700">概要</a>
                    <a href="#palaces" class="text-gray-600 hover:text-indigo-700">十二宮</a>
                    <a href="#stars" class="text-gray-600 hover:text-indigo-700">主星</a>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Hero / Calculator Section -->
        <header id="calculator" class="py-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div class="reveal">
                    <h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 leading-tight">
                        星々が綴る<br><span class="text-indigo-600 serif">至高の天命</span>
                    </h1>
                    <p class="mt-6 text-lg text-gray-600 max-w-xl">
                        生年月日、出生時間、そして場所。その瞬間の天空を支配する星々の配置を読み解き、あなたの魂の設計図を可視化します。
                    </p>

                    <!-- Simplified Calculator UI -->
                    <div class="mt-10 bg-indigo-50 p-8 rounded-2xl border border-indigo-100 shadow-sm">
                        <h3 class="text-lg font-bold text-indigo-900 mb-6 flex items-center gap-2">
                            <span>✨</span> 簡易星配置診断
                        </h3>
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="text-sm font-bold text-indigo-900 ml-1">生年月日</label>
                                    <input type="date" id="birth-date"
                                        class="w-full p-3 bg-white rounded-lg border border-indigo-200 focus:ring-2 focus:ring-indigo-500 outline-none">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-bold text-indigo-900 ml-1">出生時間</label>
                                    <input type="time" id="birth-time"
                                        class="w-full p-3 bg-white rounded-lg border border-indigo-200 focus:ring-2 focus:ring-indigo-500 outline-none">
                                </div>
                            </div>
                            <button onclick="diagnose()"
                                class="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-lg transition-all transform hover:scale-[1.02]">
                                天命を読み解く
                            </button>
                        </div>

                        <!-- Diagnosis Result area -->
                        <div id="diagnosis-result"
                            class="hidden mt-8 p-6 bg-white rounded-xl border border-indigo-100 shadow-inner fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-xs font-bold text-indigo-500 uppercase tracking-widest">Diagnosis
                                    Complete</span>
                                <span id="res-star-name" class="text-lg font-bold text-indigo-900 serif"></span>
                            </div>
                            <div class="bg-indigo-50 p-4 rounded-lg mb-4 text-sm text-indigo-800 leading-relaxed"
                                id="res-brief">
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-center">
                                <div class="p-3 bg-slate-50 rounded border border-slate-100">
                                    <span class="text-[10px] text-slate-400 block uppercase">主室（命宮）</span>
                                    <span id="res-main-palace" class="font-bold text-slate-700">--</span>
                                </div>
                                <div class="p-3 bg-slate-50 rounded border border-slate-100">
                                    <span class="text-[10px] text-slate-400 block uppercase">タイプ</span>
                                    <span id="res-type" class="font-bold text-slate-700">--</span>
                                </div>
                            </div>
                            <p class="mt-4 text-[10px] text-slate-400 text-center">※本診断は生年月日の簡易計算に基づくシミュレーションです。</p>
                        </div>
                    </div>
                </div>
                <div class="reveal flex justify-center">
                    <div class="relative w-80 h-80 md:w-96 md:h-96 flex items-center justify-center">
                        <div
                            class="absolute inset-0 border-2 border-indigo-100 rounded-full animate-[spin_30s_linear_infinite]">
                        </div>
                        <div
                            class="absolute inset-8 border border-indigo-200 rounded-full animate-[spin_20s_linear_infinite_reverse]">
                        </div>
                        <div class="text-[120px] md:text-[160px] opacity-10 text-indigo-900 select-none">紫</div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-1 bg-gradient-to-t from-transparent via-indigo-200 to-transparent h-full">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- About Section -->
        <section id="overview" class="py-24 bg-white border-y border-slate-100 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-3xl font-extrabold text-gray-900 serif">命術の最高峰、紫微斗数</h2>
                    <p class="mt-4 text-lg text-gray-500 max-w-2xl mx-auto">
                        中国発祥の「皇帝占星術」。生年月日と出生時間に基づき、100以上の星々が描き出す「命盤」を通じて、個人の多面的な宇宙を詳細に分析します。
                    </p>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="space-y-8">
                        <div class="flex gap-4 items-start">
                            <span
                                class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center shrink-0 font-bold">1</span>
                            <div>
                                <h4 class="font-bold text-gray-900">驚異の解像度</h4>
                                <p class="text-gray-600 mt-1">12の「宮」が人生のあらゆる側面（性格、財産、配偶者、仕事、健康など）を網羅し、立体的に描き出します。</p>
                            </div>
                        </div>
                        <div class="flex gap-4 items-start">
                            <span
                                class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center shrink-0 font-bold">2</span>
                            <div>
                                <h4 class="font-bold text-gray-900">運命のバイオリズム</h4>
                                <p class="text-gray-600 mt-1">10年ごとの「大限」、1年ごとの「太歳」により、精密な時期判断と行動指針を提供します。</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                        <h4 class="text-center text-sm font-bold text-indigo-400 mb-6 uppercase tracking-widest">
                            占術特性レーダー</h4>
                        <div class="h-64 relative">
                            <canvas id="capabilityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 12 Palaces Section -->
        <section id="palaces" class="py-24 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
            <h2 class="text-3xl font-extrabold text-gray-900 serif text-center mb-12">人生の十二、運命の舞台</h2>
            <div class="grid lg:grid-cols-2 gap-12">
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="palace-grid">
                    <!-- Populated by JS -->
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 flex flex-col justify-center min-h-[400px]"
                    id="palace-detail">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center text-3xl"
                            id="detail-icon">👑</div>
                        <div>
                            <h3 class="text-2xl font-bold serif text-indigo-900" id="detail-name">命宮</h3>
                            <p class="text-sm text-indigo-400 font-medium" id="detail-yomi">Mei-kyu</p>
                        </div>
                    </div>
                    <h4 class="text-xl font-bold mb-4 text-slate-800" id="detail-subtitle">運命の司令塔・あなたの本質</h4>
                    <p class="text-gray-600 leading-relaxed mb-8" id="detail-desc">
                        ここはあなたの性格、才能、容姿、そして一生の運命の土台となる場所です。ここに入る星が、あなたの「魂の輪郭」を決定づけます。
                    </p>
                    <div class="flex flex-wrap gap-2" id="detail-keywords">
                        <span class="px-3 py-1 bg-slate-100 rounded-full text-xs text-slate-500">本質</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 14 Stars Section -->
        <section id="stars" class="py-24 bg-slate-50 border-y border-slate-100 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto">
                <div class="grid lg:grid-cols-3 gap-12">
                    <div class="lg:col-span-1">
                        <h2 class="text-3xl font-extrabold text-gray-900 serif mb-8">輝ける十四の主星</h2>
                        <div class="space-y-1 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar" id="star-nav-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl p-8 md:p-12 shadow-sm border border-slate-200 min-h-[550px] relative overflow-hidden"
                            id="star-detail-panel">
                            <div id="star-content" class="relative z-10 transition-all duration-300">
                                <div class="flex justify-between items-start mb-8">
                                    <div>
                                        <span
                                            class="text-indigo-500 text-xs font-bold tracking-widest mb-2 block uppercase"
                                            id="star-group">北斗主星</span>
                                        <h3 class="text-4xl font-bold serif text-indigo-900 mb-2" id="star-name">紫微星
                                        </h3>
                                        <p class="text-slate-400 text-sm tracking-widest font-mono" id="star-alias">THE
                                            EMPEROR</p>
                                    </div>
                                    <div class="text-7xl opacity-5 select-none" id="star-icon">👑</div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 mb-8">
                                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <span class="text-[10px] uppercase text-indigo-400 block mb-1">五行</span>
                                        <p class="font-bold text-slate-700" id="star-element">土 (陰)</p>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <span class="text-[10px] uppercase text-indigo-400 block mb-1">象意</span>
                                        <p class="font-bold text-slate-700" id="star-attribute">尊貴・権威</p>
                                    </div>
                                </div>
                                <div class="space-y-6">
                                    <div>
                                        <h4
                                            class="text-sm font-bold text-indigo-900 uppercase tracking-widest mb-3 border-b border-indigo-50 pb-2">
                                            本質的性質</h4>
                                        <p class="text-gray-600 leading-relaxed" id="star-description">
                                            帝王の象徴であり、命盤の中心。強い自尊心と統率力を持ち、周囲を慈しむ高貴な精神を宿します。
                                        </p>
                                    </div>
                                    <div class="bg-indigo-50/50 p-6 rounded-xl border border-indigo-100">
                                        <h4 class="text-sm font-bold text-indigo-900 uppercase tracking-widest mb-3">
                                            現代の解釈</h4>
                                        <p class="text-indigo-800 text-sm leading-relaxed italic" id="star-modern">
                                            経営層やリーダーとしての資質。プライドが高く孤独を恐れる一面も。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-16 bg-white text-center">
            <div class="max-w-7xl mx-auto px-6">
                <div class="text-indigo-900 tracking-[0.2em] font-bold mb-4 serif text-xl">TRISCOPE</div>
                <p class="text-slate-400 text-sm">Ancient Wisdom for a Modern World</p>
                <div class="mt-8 text-slate-300 text-[10px] tracking-widest space-y-2 uppercase">
                    <p>&copy; 2026 TRISCOPE CELESTIAL GUIDANCE. ALL RIGHTS RESERVED.</p>
                </div>
            </div>
        </footer>
    </main>

    <script>
        // --- Data ---
        const palaces = [
            { id: "life", name: "命宮", yomi: "Mei-kyu", icon: "👑", subtitle: "運命の司令塔・あなたの本質", desc: "ここはあなたの性格、才能、容姿、そして一生の運命の土台となる場所です。ここに入る星が、あなたの「魂の輪郭」を決定づけます。", keywords: ["本質", "才能", "一生の運"] },
            { id: "siblings", name: "兄弟宮", yomi: "Keitei-kyu", icon: "👥", subtitle: "親しき人々との響き合わせ", desc: "兄弟姉妹や深い絆で結ばれた親友、同僚との関係を見ます。助け合えるか、あるいは競い合う仲かを暗示します。", keywords: ["兄弟姉妹", "同僚", "親友"] },
            { id: "spouse", name: "夫妻宮", yomi: "Fusai-kyu", icon: "💍", subtitle: "魂の伴侶・愛のカタチ", desc: "好みのタイプや、将来出会う伴侶の性格、結婚後の家庭環境を示します。愛がどのような試練や喜びをもたらすかを説きます。", keywords: ["結婚", "恋愛", "パートナー"] },
            { id: "children", name: "子女宮", yomi: "Shijo-kyu", icon: "👶", subtitle: "次世代への継承と創造", desc: "子供との縁、部下や後輩との関係、そしてあなたの性的な魅力や生命力の源泉をも表します。", keywords: ["子供", "後輩", "生命力"] },
            { id: "wealth", name: "財帛宮", yomi: "Zaihaku-kyu", icon: "💰", subtitle: "豊かさの源泉・金銭の流転", desc: "どのように富を築き、どのように使うか。あなたにとって「富」とは何か、その哲学と実利の両面を映し出します。", keywords: ["金運", "稼ぎ方", "財産"] },
            { id: "health", name: "疾厄宮", yomi: "Shitsuyaku-kyu", icon: "🏥", subtitle: "肉体の器・浄化のプロセス", desc: "健康状態、かかりやすい病気、身体の弱点。内面に抱えるストレスがどこに現れやすいかを示します。", keywords: ["健康", "体質", "未病"] },
            { id: "travel", name: "遷移宮", yomi: "Sen-i-kyu", icon: "✈️", subtitle: "外の世界・社会的な仮面", desc: "移動による運気、社会的な顔、初対面の印象。一歩家を出た時のあなたの「輝き」がここにあります。", keywords: ["外出", "第一印象", "移動"] },
            { id: "friends", name: "奴僕宮", yomi: "Nubo-kyu", icon: "🤝", subtitle: "社会との繋がり・支援の輪", desc: "広い交友関係、顧客、ファン、不特定多数の人々との関係。世の中からどのような支持を受けるかを表します。", keywords: ["友人", "支持層", "ファン"] },
            { id: "career", name: "官禄宮", yomi: "Kanroku-kyu", icon: "💼", subtitle: "天職と功績・磨かれる魂", desc: "仕事への姿勢、適職、社会的成功への階段。あなたが魂を込めて取り組むべき活動の方向性がここにあります。", keywords: ["仕事", "出世", "適職"] },
            { id: "property", name: "田宅宮", yomi: "Dentaku-kyu", icon: "🏠", subtitle: "安住の地・蓄えられた実り", desc: "不動産運、住環境、そして先祖から受け継ぐ精神的な資産。心休まる「場所」を見極めるための宮です。", keywords: ["不動産", "住まい", "貯蓄"] },
            { id: "mental", name: "福徳宮", yomi: "Fukutoku-kyu", icon: "🧘", subtitle: "精神の平安・内なる幸福", desc: "魂の安定度、趣味、深層心理。何に喜びを感じ、どのように安らぎを得るかという精神のクオリティを司ります。", keywords: ["精神", "寿命", "幸福度"] },
            { id: "parents", name: "父母宮", yomi: "Fubo-kyu", icon: "👴", subtitle: "ルーツと権威・目上の導き", desc: "両親、上司、目上の人々。あなたのルーツを支える人々からの恩恵や、解決すべき因縁を読み解きます。", keywords: ["両親", "上司", "後ろ盾"] }
        ];

        const stars = [
            { name: "紫微星", yomi: "Shibi-sei", alias: "THE EMPEROR", group: "北斗主星", icon: "👑", element: "土（陰）", attribute: "尊貴・統率", desc: "帝王の象徴。強い自尊心と統率力を持ち、高貴な精神を宿します。周囲からの補佐があってこそ真の力を発揮します。", modern: "経営者、組織のトップ。自分のプライドと責任感で人を動かす適性があります。" },
            { name: "天機星", yomi: "Tenki-sei", alias: "THE STRATEGIST", group: "南斗星", icon: "🧠", element: "木（陰）", attribute: "知恵・変化", desc: "参謀の星。非常に頭の回転が速く、知識欲が旺盛です。変化を好み、新しいものを企画する才能に長けます。", modern: "IT・技術職、プランナー、研究職。知的な好奇心を満たす環境で輝きます。" },
            { name: "太陽星", yomi: "Taiyo-sei", alias: "THE SUN", group: "中天星", icon: "☀️", element: "火（陽）", attribute: "博愛・光明", desc: "周囲を平等に照らす光。公序良俗に則り、寛大で他人を助けることに喜びを感じます。一方で、見栄を張りやすい面も。", modern: "教育、マスコミ、公益事業。公の場で多くの人の注目を集める仕事に向きます。" },
            { name: "武曲星", yomi: "Bugoku-sei", alias: "THE GENERAL", group: "北斗星", icon: "⚔️", element: "金（陰）", attribute: "決断・財星", desc: "実行力ある将軍。ドライですが、決断力と実務能力に優れ、確実に成果や財を手にします。寡黙で孤独を好む傾向があります。", modern: "金融、実業、専門技術。実利を重視するシビアな環境で圧倒的な成果を出します。" },
            { name: "天同星", yomi: "Tendo-sei", alias: "THE CHILD", group: "南斗星", icon: "👶", element: "水（陽）", attribute: "温和・享受", desc: "福の神の星。子供のように無邪気で、穏やかな性格。周囲との調和を重んじ、楽しみを見つけるのが得意です。", modern: "サービス業、カウンセリング、芸能。周囲を癒やし、楽しませる役割。" },
            { name: "廉貞星", yomi: "Rentei-sei", alias: "THE DIPLOMAT", group: "北斗星", icon: "🔥", element: "火（陰）", attribute: "権威・感性", desc: "「次なる魅力の星」。凛とした強さと情熱を秘めます。仕事には非常に厳格ですが、内面は非常に多感で複雑です。", modern: "行政関係、デザイン、芸能。規律と美的感覚が必要な分野。" },
            { name: "天府星", yomi: "Tenpu-sei", alias: "THE TREASURER", group: "南斗主星", icon: "🏦", element: "土（陽）", attribute: "安定・慈愛", desc: "慈愛満ちた金庫。保守的で安定を好み、豊かな包容力で周囲を包みます。組織を維持・管理する能力が非常に高いです。", modern: "銀行、不動産、総務、経営安定期のリーダー。守備力の高さを活かす場。" },
            { name: "太陰星", yomi: "Taiin-sei", alias: "THE MOON", group: "中天星", icon: "🌙", element: "水（陰）", attribute: "ロマン・慈愛", desc: "静寂の月。感受性が豊かで、美を愛するロマンチスト。控えめですが、深い思考と母性的な優しさを持ちます。", modern: "芸術家、デザイナー、不動産、ケア職。繊細な感覚が武器になります。" },
            { name: "貪狼星", yomi: "Donro-sei", alias: "THE WOLF", group: "北斗星", icon: "🐺", element: "木・水", attribute: "社交・欲望", desc: "欲望と芸の星。飽くなき好奇心と卓越した社交術。人生を遊び尽くすエネルギーに満ち、多芸多才です。", modern: "営業、フリーランス、実業。人を惹きつけるカリスマ性を発揮します。" },
            { name: "巨門星", yomi: "Komon-sei", alias: "THE ORATOR", group: "北斗星", icon: "🗣️", element: "水（陰）", attribute: "口才・分析", desc: "口の星。優れた弁説と鋭い分析力。物事の裏側を見抜く力がありますが、言葉によるトラブルには注意が必要です。", modern: "法律家、教師、評論家、アナウンサー、研究者。正確な言語化が求められる仕事。" },
            { name: "天相星", yomi: "Tenso-sei", alias: "THE MINISTER", group: "南斗星", icon: "🛡️", element: "水（陽）", attribute: "補佐・慈愛", desc: "誠実なパートナー。人を助けることで自分が輝く「補佐の星」。身なりを整え、調和ある環境を作ります。", modern: "秘書、公務員、ホスピタリティ産業。優れた調整役として必要とされます。" },
            { name: "天梁星", yomi: "Tenryo-sei", alias: "THE SAGE", group: "南斗星", icon: "✨", element: "土（陽）", attribute: "指導・慈愛", desc: "賢者の星。落ち着きがあり、面倒見の良い親分肌。困難を乗り越える守護の力を持ち、指導者的な立場に置かれます。", modern: "医療、教育、コンサルタント、監査。徳を持って人を導く役割。" },
            { name: "七殺星", yomi: "Shichisatsu-sei", alias: "THE WARRIOR", group: "南斗星", icon: "🗡️", element: "金・火", attribute: "権威・独行", desc: "孤独な勇者。ずば抜けた行動力と独立心を持ちます。変化を恐れず、荒波の中に活路を見出します。", modern: "ベンチャー起業家、アスリート、外科医。個人の力で勝負する世界。" },
            { name: "破軍星", yomi: "Hagun-sei", alias: "THE REBEL", group: "北斗星", icon: "🌊", element: "水（陰）", attribute: "耗散・開拓", desc: "破壊と創造。既存の概念を壊し、ゼロから新しいものを作り出す猛烈なエネルギーです。人生の変動が激しくなります。", modern: "新技術開発、開拓者、イノベーター。誰も通っていない道を切り拓く場。" }
        ];

        // --- Core Functions ---

        document.addEventListener('DOMContentLoaded', () => {
            initCapabilityChart();
            renderPalaces();
            renderStarNav();
            setupIntersectionObserver();

            // Defaults
            selectPalace(0);
            selectStar(0);
        });

        function diagnose() {
            const date = document.getElementById('birth-date').value;
            const time = document.getElementById('birth-time').value;

            if (!date) {
                alert("生年月日を入力してください。");
                return;
            }

            const resultArea = document.getElementById('diagnosis-result');
            resultArea.classList.remove('hidden');
            resultArea.classList.add('fade-in');

            // Simplified Pseudo-Logic for Demo
            const d = new Date(date);
            const sum = d.getFullYear() + d.getMonth() + d.getDate();
            const starIndex = sum % stars.length;
            const star = stars[starIndex];

            document.getElementById('res-star-name').textContent = star.name;
            document.getElementById('res-brief').innerHTML = `<strong>主星: ${star.name}</strong><br>${star.desc}`;
            document.getElementById('res-main-palace').textContent = "命宮";
            document.getElementById('res-type').textContent = star.group;

            // Scroll to result
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function initCapabilityChart() {
            const ctx = document.getElementById('capabilityChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['深層心理', '人生の時期', '才能・適性', '対人関係', 'YES/NO', '毎日の運勢'],
                    datasets: [{
                        label: '紫微斗数',
                        data: [95, 98, 92, 90, 40, 50],
                        backgroundColor: 'rgba(91, 33, 182, 0.2)',
                        borderColor: '#5B21B6',
                        pointBackgroundColor: '#5B21B6',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            ticks: { display: false, max: 100 },
                            pointLabels: { color: '#6B7280', font: { size: 10 } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderPalaces() {
            const grid = document.getElementById('palace-grid');
            palaces.forEach((p, i) => {
                const card = document.createElement('div');
                card.className = `palace-card bg-white p-4 rounded-xl text-center flex flex-col items-center justify-center h-24 palace-item-${i}`;
                card.innerHTML = `<span class="text-xl mb-1">${p.icon}</span><span class="text-xs font-bold">${p.name}</span>`;
                card.onclick = () => selectPalace(i, card);
                grid.appendChild(card);
            });
        }

        function selectPalace(index, el) {
            document.querySelectorAll('.palace-card').forEach(c => c.classList.remove('active'));
            if (el) el.classList.add('active');
            else {
                const first = document.querySelector('.palace-item-0');
                if (first) first.classList.add('active');
            }

            const p = palaces[index];
            const detail = document.getElementById('palace-detail');
            detail.style.opacity = '0';

            setTimeout(() => {
                document.getElementById('detail-icon').textContent = p.icon;
                document.getElementById('detail-name').textContent = p.name;
                document.getElementById('detail-yomi').textContent = p.yomi;
                document.getElementById('detail-subtitle').textContent = p.subtitle;
                document.getElementById('detail-desc').textContent = p.desc;

                const kw = document.getElementById('detail-keywords');
                kw.innerHTML = '';
                p.keywords.forEach(k => {
                    const s = document.createElement('span');
                    s.className = 'px-3 py-1 bg-slate-100 rounded-full text-xs text-slate-500';
                    s.textContent = k;
                    kw.appendChild(s);
                });
                detail.style.opacity = '1';
            }, 200);
        }

        function renderStarNav() {
            const nav = document.getElementById('star-nav-list');
            stars.forEach((s, i) => {
                const btn = document.createElement('button');
                btn.className = `star-link text-left py-2 w-full text-sm block star-btn-${i}`;
                btn.textContent = `${s.name} (${s.alias})`;
                btn.onclick = () => selectStar(i, btn);
                nav.appendChild(btn);
            });
        }

        function selectStar(index, el) {
            document.querySelectorAll('.star-link').forEach(l => l.classList.remove('active'));
            if (el) el.classList.add('active');
            else {
                const first = document.querySelector('.star-btn-0');
                if (first) first.classList.add('active');
            }

            const s = stars[index];
            const content = document.getElementById('star-content');
            content.style.opacity = '0';

            setTimeout(() => {
                document.getElementById('star-group').textContent = s.group;
                document.getElementById('star-name').textContent = s.name;
                document.getElementById('star-alias').textContent = s.alias;
                document.getElementById('star-icon').textContent = s.icon;
                document.getElementById('star-element').textContent = s.element;
                document.getElementById('star-attribute').textContent = s.attribute;
                document.getElementById('star-description').textContent = s.desc;
                document.getElementById('star-modern').textContent = s.modern;
                content.style.opacity = '1';
            }, 200);
        }

        function setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

    </script>
</body>

</html>